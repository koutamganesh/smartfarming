<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Farming Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'UnifrakturCook', cursive;
    }
  </style>
</head>
<body class="bg-sky-400 min-h-screen flex flex-col items-center pt-4 px-4">
  <h1 class="text-green-600 text-xl mb-6">Smart Farming Dashboard</h1>

  <section class="bg-white bg-opacity-90 rounded-lg shadow-md w-full max-w-md p-6 mb-6">
    <h2 class="text-center text-lg mb-3">Sensor Readings</h2>
    <p><span class="font-semibold">Temperature:</span> <span id="sensor-temp">loading...</span></p>
    <p><span class="font-semibold">Soil Moisture:</span> <span id="soil-moisture">loading...</span></p>
  </section>

  <section class="bg-white bg-opacity-90 rounded-lg shadow-md w-full max-w-md p-6 mb-6">
    <h2 class="text-center text-lg mb-3">Weather Report</h2>
    <p><span class="font-semibold">Location:</span> <span id="location">Loading...</span></p>
    <p><span class="font-semibold">Weather:</span> <span id="weather-desc">Loading...</span></p>
    <p><span class="font-semibold">Temp:</span> <span id="weather-temp">Loading - °C</span></p>
  </section>

  <section class="bg-white bg-opacity-90 rounded-lg shadow-md w-full max-w-md p-6">
    <h2 class="text-center text-lg mb-3">Motor Control</h2>
    <div class="flex justify-center mb-2">
      <button class="bg-gray-300 text-gray-700 text-sm px-3 py-1 rounded">Turn Motor ON</button>
    </div>
    <p class="text-center">Motor is OFF</p>
  </section>

  <script>
    async function fetchWeather(lat, lon) {
      try {
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
        const data = await response.json();
        if (data && data.current_weather) {
          const tempC = data.current_weather.temperature;
          const weatherCode = data.current_weather.weathercode;

          const weatherDescriptions = {
            0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
            45: "Fog", 48: "Depositing rime fog", 51: "Light drizzle", 53: "Moderate drizzle",
            55: "Dense drizzle", 56: "Light freezing drizzle", 57: "Dense freezing drizzle",
            61: "Slight rain", 63: "Moderate rain", 65: "Heavy rain",
            66: "Light freezing rain", 67: "Heavy freezing rain", 71: "Slight snow fall",
            73: "Moderate snow fall", 75: "Heavy snow fall", 77: "Snow grains",
            80: "Slight rain showers", 81: "Moderate rain showers", 82: "Violent rain showers",
            85: "Slight snow showers", 86: "Heavy snow showers", 95: "Thunderstorm",
            96: "Thunderstorm with slight hail", 99: "Thunderstorm with heavy hail"
          };

          const desc = weatherDescriptions[weatherCode] || "Unknown";
          document.getElementById('weather-temp').textContent = `${tempC} °C`;
          document.getElementById('weather-desc').textContent = desc;
          document.getElementById('sensor-temp').textContent = `${tempC} °C`;

          // Simulate soil moisture value for demo purposes
          const soilMoisture = (Math.random() * 100).toFixed(1);
          document.getElementById('soil-moisture').textContent = `${soilMoisture} %`;
        } else {
          document.getElementById('weather-temp').textContent = "Unavailable";
          document.getElementById('weather-desc').textContent = "Unavailable";
          document.getElementById('sensor-temp').textContent = "Unavailable";
          document.getElementById('soil-moisture').textContent = "Unavailable";
        }
      } catch (error) {
        document.getElementById('weather-temp').textContent = "Error";
        document.getElementById('weather-desc').textContent = "Error";
        document.getElementById('sensor-temp').textContent = "Error";
        document.getElementById('soil-moisture').textContent = "Error";
      }
    }

    function fetchLocationAndWeather() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lat = position.coords.latitude.toFixed(4);
            const lon = position.coords.longitude.toFixed(4);
            document.getElementById('location').textContent = `Lat: ${lat}, Lon: ${lon}`;
            fetchWeather(lat, lon);
          },
          () => {
            document.getElementById('location').textContent = "Permission denied";
            document.getElementById('weather-desc').textContent = "Unavailable";
            document.getElementById('weather-temp').textContent = "Unavailable";
            document.getElementById('sensor-temp').textContent = "Unavailable";
            document.getElementById('soil-moisture').textContent = "Unavailable";
          }
        );
      } else {
        document.getElementById('location').textContent = "Geolocation not supported";
        document.getElementById('weather-desc').textContent = "Unavailable";
        document.getElementById('weather-temp').textContent = "Unavailable";
        document.getElementById('sensor-temp').textContent = "Unavailable";
        document.getElementById('soil-moisture').textContent = "Unavailable";
      }
    }

    fetchLocationAndWeather();
  </script>
</body>
</html>
